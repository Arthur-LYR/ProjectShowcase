import unittest
from unittest.mock import Mock
from app.calculator import *


class TestCostCalculation2(unittest.TestCase):
    CALCULATOR = Calculator()

    def test_no_time(self):
        time = (0, 0)
        start_date = "12/6/2021"
        start_time = "6:12"
        charger_configuration = "5"
        location = "5b805648-9ce2-4a7b-a2e7-38f15d9c3288"

        requests_mock = Mock()
        response_mock = Mock()
        requests_mock.get.return_value = response_mock
        response_mock.status_code = 200
        response_mock.json.return_value = {"date":"2021-06-12","sunrise":"06:57:00","sunset":"16:53:00","moonrise":"08:22:00","moonset":"18:11:00","moonPhase":"Waxing Crescent","moonIlluminationPct":11,"minTempC":10,"maxTempC":16,"avgTempC":13,"sunHours":3,"uvIndex":4,"location":{"id":"5b805648-9ce2-4a7b-a2e7-38f15d9c3288","postcode":"2131","name":"ASHFIELD","state":"NSW","latitude":"-33.8904917","longitude":"151.1254852","distanceToNearestWeatherStationMetres":2025.8089857155846,"nearestWeatherStation":{"name":"CANTERBURY RACECOURSE AWS","state":"NSW","latitude":"-33.9057","longitude":"151.1134"}},"hourlyWeatherHistory":[{"hour":0,"tempC":11,"weatherDesc":"Partly cloudy","cloudCoverPct":22,"uvIndex":1,"windspeedKph":18,"windDirectionDeg":303,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":73,"visibilityKm":10,"pressureMb":1015},{"hour":1,"tempC":11,"weatherDesc":"Partly cloudy","cloudCoverPct":19,"uvIndex":1,"windspeedKph":18,"windDirectionDeg":304,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":74,"visibilityKm":10,"pressureMb":1015},{"hour":2,"tempC":11,"weatherDesc":"Partly cloudy","cloudCoverPct":17,"uvIndex":1,"windspeedKph":17,"windDirectionDeg":305,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":75,"visibilityKm":10,"pressureMb":1015},{"hour":3,"tempC":10,"weatherDesc":"Partly cloudy","cloudCoverPct":14,"uvIndex":1,"windspeedKph":17,"windDirectionDeg":305,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":76,"visibilityKm":10,"pressureMb":1015},{"hour":4,"tempC":10,"weatherDesc":"Partly cloudy","cloudCoverPct":11,"uvIndex":1,"windspeedKph":17,"windDirectionDeg":307,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":76,"visibilityKm":10,"pressureMb":1016},{"hour":5,"tempC":10,"weatherDesc":"Partly cloudy","cloudCoverPct":9,"uvIndex":1,"windspeedKph":16,"windDirectionDeg":308,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":76,"visibilityKm":10,"pressureMb":1016},{"hour":6,"tempC":10,"weatherDesc":"Partly cloudy","cloudCoverPct":7,"uvIndex":3,"windspeedKph":16,"windDirectionDeg":310,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":76,"visibilityKm":10,"pressureMb":1016},{"hour":7,"tempC":10,"weatherDesc":"Partly cloudy","cloudCoverPct":5,"uvIndex":4,"windspeedKph":17,"windDirectionDeg":309,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":72,"visibilityKm":10,"pressureMb":1017},{"hour":8,"tempC":11,"weatherDesc":"Partly cloudy","cloudCoverPct":3,"uvIndex":4,"windspeedKph":18,"windDirectionDeg":308,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":68,"visibilityKm":10,"pressureMb":1017},{"hour":9,"tempC":12,"weatherDesc":"Partly cloudy","cloudCoverPct":1,"uvIndex":4,"windspeedKph":18,"windDirectionDeg":307,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":64,"visibilityKm":10,"pressureMb":1017},{"hour":10,"tempC":13,"weatherDesc":"Partly cloudy","cloudCoverPct":1,"uvIndex":4,"windspeedKph":17,"windDirectionDeg":304,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":58,"visibilityKm":10,"pressureMb":1017},{"hour":11,"tempC":14,"weatherDesc":"Sunny","cloudCoverPct":0,"uvIndex":4,"windspeedKph":16,"windDirectionDeg":301,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":53,"visibilityKm":10,"pressureMb":1016},{"hour":12,"tempC":15,"weatherDesc":"Sunny","cloudCoverPct":0,"uvIndex":5,"windspeedKph":15,"windDirectionDeg":297,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":47,"visibilityKm":10,"pressureMb":1016},{"hour":13,"tempC":16,"weatherDesc":"Sunny","cloudCoverPct":0,"uvIndex":5,"windspeedKph":16,"windDirectionDeg":300,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":47,"visibilityKm":10,"pressureMb":1016},{"hour":14,"tempC":16,"weatherDesc":"Sunny","cloudCoverPct":1,"uvIndex":5,"windspeedKph":16,"windDirectionDeg":302,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":47,"visibilityKm":10,"pressureMb":1015},{"hour":15,"tempC":16,"weatherDesc":"Sunny","cloudCoverPct":1,"uvIndex":5,"windspeedKph":17,"windDirectionDeg":304,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":47,"visibilityKm":10,"pressureMb":1015},{"hour":16,"tempC":15,"weatherDesc":"Sunny","cloudCoverPct":1,"uvIndex":5,"windspeedKph":16,"windDirectionDeg":302,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":51,"visibilityKm":10,"pressureMb":1015},{"hour":17,"tempC":15,"weatherDesc":"Partly cloudy","cloudCoverPct":1,"uvIndex":4,"windspeedKph":16,"windDirectionDeg":300,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":56,"visibilityKm":10,"pressureMb":1016},{"hour":18,"tempC":14,"weatherDesc":"Partly cloudy","cloudCoverPct":1,"uvIndex":1,"windspeedKph":16,"windDirectionDeg":298,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":60,"visibilityKm":10,"pressureMb":1016},{"hour":19,"tempC":14,"weatherDesc":"Partly cloudy","cloudCoverPct":0,"uvIndex":1,"windspeedKph":15,"windDirectionDeg":298,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":63,"visibilityKm":10,"pressureMb":1016},{"hour":20,"tempC":13,"weatherDesc":"Clear","cloudCoverPct":0,"uvIndex":1,"windspeedKph":14,"windDirectionDeg":297,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":66,"visibilityKm":10,"pressureMb":1017},{"hour":21,"tempC":13,"weatherDesc":"Clear","cloudCoverPct":0,"uvIndex":1,"windspeedKph":13,"windDirectionDeg":296,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":69,"visibilityKm":10,"pressureMb":1017},{"hour":22,"tempC":12,"weatherDesc":"Clear","cloudCoverPct":1,"uvIndex":1,"windspeedKph":14,"windDirectionDeg":298,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":71,"visibilityKm":10,"pressureMb":1017},{"hour":23,"tempC":11,"weatherDesc":"Clear","cloudCoverPct":1,"uvIndex":1,"windspeedKph":15,"windDirectionDeg":300,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":72,"visibilityKm":10,"pressureMb":1017}]}

        expected = 0
        actual = self.CALCULATOR.cost_calculation_2(time, start_date, start_time, charger_configuration, location, api=requests_mock)
        self.assertAlmostEqual(expected, actual, 2)

    def test_date_too_early(self):
        time = (9, 8)
        start_date = "30/6/2008"
        start_time = "23:59"
        charger_configuration = "1"
        location = "cdbd6232-2447-4029-89c2-bfb809e6e7b5"

        requests_mock = Mock()
        response_mock = Mock()
        requests_mock.get.return_value = response_mock
        response_mock.status_code = 400
        response_mock.json.return_value = {"statusCode":400,"message":"Date must be specified, formatted in YYYY-MM-DD and be between 2008-07-01 and 2021-09-28.","error":"Bad Request"}

        with self.assertRaises(ValueError):
            self.CALCULATOR.cost_calculation_2(time, start_date, start_time, charger_configuration, location, api=requests_mock)

    def test_date_too_late(self):
        time = (1, 0)
        start_date = "30/9/2021"
        start_time = "0:01"
        charger_configuration = "4"
        location = "c351afe2-5eb1-4d69-9d11-e9cf45f6a518"

        requests_mock = Mock()
        response_mock = Mock()
        requests_mock.get.return_value = response_mock
        response_mock.status_code = 400
        response_mock.json.return_value = {"statusCode":400,"message":"Date must be specified, formatted in YYYY-MM-DD and be between 2008-07-01 and 2021-09-28.","error":"Bad Request"}
        datetime_mock = Mock()
        datetime_mock.now.return_value = datetime(2021, 9, 30, 0, 0, 0)

        with self.assertRaises(ValueError):
            self.CALCULATOR.cost_calculation_2(time, start_date, start_time, charger_configuration, location, api=requests_mock, date_object=datetime_mock)

    def test_no_solar_energy_produced(self):
        time = (2, 0)
        start_date = "16/7/2021"
        start_time = "23:00"
        charger_configuration = "1"
        location = "5bea7b46-9809-4189-aafe-160208da94f7"

        requests_mock = Mock()
        response_mock = Mock()
        requests_mock.get.return_value = response_mock
        response_mock.status_code = 200
        response_mock.json.return_value = {"date":"2021-07-16","sunrise":"07:15:00","sunset":"17:31:00","moonrise":"11:18:00","moonset":"23:41:00","moonPhase":"First Quarter","moonIlluminationPct":43,"minTempC":13,"maxTempC":16,"avgTempC":15,"sunHours":2.3,"uvIndex":3,"location":{"id":"5bea7b46-9809-4189-aafe-160208da94f7","postcode":"6001","name":"PERTH","state":"WA","latitude":"-31.9505269","longitude":"115.8604572","distanceToNearestWeatherStationMetres":3672.959393589811,"nearestWeatherStation":{"name":"PERTH METRO","state":"WA","latitude":"-31.9192","longitude":"115.8728"}},"hourlyWeatherHistory":[{"hour":0,"tempC":13,"weatherDesc":"Cloudy","cloudCoverPct":85,"uvIndex":1,"windspeedKph":6,"windDirectionDeg":199,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":76,"visibilityKm":9,"pressureMb":1023},{"hour":1,"tempC":13,"weatherDesc":"Cloudy","cloudCoverPct":87,"uvIndex":1,"windspeedKph":6,"windDirectionDeg":206,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":76,"visibilityKm":10,"pressureMb":1023},{"hour":2,"tempC":13,"weatherDesc":"Patchy rain possible","cloudCoverPct":90,"uvIndex":1,"windspeedKph":5,"windDirectionDeg":213,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":75,"visibilityKm":10,"pressureMb":1023},{"hour":3,"tempC":13,"weatherDesc":"Patchy rain possible","cloudCoverPct":92,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":220,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":75,"visibilityKm":10,"pressureMb":1023},{"hour":4,"tempC":13,"weatherDesc":"Patchy rain possible","cloudCoverPct":94,"uvIndex":1,"windspeedKph":3,"windDirectionDeg":224,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":76,"visibilityKm":10,"pressureMb":1023},{"hour":5,"tempC":13,"weatherDesc":"Overcast","cloudCoverPct":97,"uvIndex":1,"windspeedKph":3,"windDirectionDeg":228,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":76,"visibilityKm":10,"pressureMb":1023},{"hour":6,"tempC":13,"weatherDesc":"Overcast","cloudCoverPct":100,"uvIndex":3,"windspeedKph":3,"windDirectionDeg":232,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":77,"visibilityKm":10,"pressureMb":1023},{"hour":7,"tempC":14,"weatherDesc":"Overcast","cloudCoverPct":95,"uvIndex":3,"windspeedKph":3,"windDirectionDeg":225,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":77,"visibilityKm":10,"pressureMb":1024},{"hour":8,"tempC":14,"weatherDesc":"Light rain shower","cloudCoverPct":91,"uvIndex":3,"windspeedKph":4,"windDirectionDeg":218,"windDirectionCompass":"SW","precipitationMm":0.1,"humidityPct":78,"visibilityKm":10,"pressureMb":1024},{"hour":9,"tempC":14,"weatherDesc":"Light rain shower","cloudCoverPct":86,"uvIndex":3,"windspeedKph":5,"windDirectionDeg":211,"windDirectionCompass":"SSW","precipitationMm":0.1,"humidityPct":78,"visibilityKm":10,"pressureMb":1025},{"hour":10,"tempC":15,"weatherDesc":"Light rain shower","cloudCoverPct":78,"uvIndex":3,"windspeedKph":7,"windDirectionDeg":206,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":75,"visibilityKm":10,"pressureMb":1025},{"hour":11,"tempC":15,"weatherDesc":"Cloudy","cloudCoverPct":69,"uvIndex":4,"windspeedKph":9,"windDirectionDeg":201,"windDirectionCompass":"SSW","precipitationMm":0.1,"humidityPct":73,"visibilityKm":10,"pressureMb":1025},{"hour":12,"tempC":16,"weatherDesc":"Cloudy","cloudCoverPct":60,"uvIndex":4,"windspeedKph":10,"windDirectionDeg":195,"windDirectionCompass":"SSW","precipitationMm":0.1,"humidityPct":70,"visibilityKm":10,"pressureMb":1025},{"hour":13,"tempC":16,"weatherDesc":"Cloudy","cloudCoverPct":64,"uvIndex":4,"windspeedKph":11,"windDirectionDeg":192,"windDirectionCompass":"SSW","precipitationMm":0.1,"humidityPct":69,"visibilityKm":10,"pressureMb":1025},{"hour":14,"tempC":16,"weatherDesc":"Cloudy","cloudCoverPct":67,"uvIndex":4,"windspeedKph":11,"windDirectionDeg":189,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":68,"visibilityKm":10,"pressureMb":1025},{"hour":15,"tempC":16,"weatherDesc":"Cloudy","cloudCoverPct":71,"uvIndex":4,"windspeedKph":11,"windDirectionDeg":185,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":67,"visibilityKm":10,"pressureMb":1024},{"hour":16,"tempC":15,"weatherDesc":"Cloudy","cloudCoverPct":76,"uvIndex":4,"windspeedKph":9,"windDirectionDeg":181,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":68,"visibilityKm":10,"pressureMb":1025},{"hour":17,"tempC":15,"weatherDesc":"Cloudy","cloudCoverPct":80,"uvIndex":4,"windspeedKph":7,"windDirectionDeg":177,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":70,"visibilityKm":10,"pressureMb":1025},{"hour":18,"tempC":15,"weatherDesc":"Cloudy","cloudCoverPct":85,"uvIndex":1,"windspeedKph":6,"windDirectionDeg":173,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":71,"visibilityKm":10,"pressureMb":1025},{"hour":19,"tempC":14,"weatherDesc":"Cloudy","cloudCoverPct":81,"uvIndex":1,"windspeedKph":5,"windDirectionDeg":157,"windDirectionCompass":"SSE","precipitationMm":0,"humidityPct":72,"visibilityKm":10,"pressureMb":1025},{"hour":20,"tempC":14,"weatherDesc":"Partly cloudy","cloudCoverPct":78,"uvIndex":1,"windspeedKph":5,"windDirectionDeg":140,"windDirectionCompass":"SE","precipitationMm":0,"humidityPct":73,"visibilityKm":10,"pressureMb":1025},{"hour":21,"tempC":14,"weatherDesc":"Partly cloudy","cloudCoverPct":74,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":123,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":74,"visibilityKm":10,"pressureMb":1025},{"hour":22,"tempC":14,"weatherDesc":"Partly cloudy","cloudCoverPct":57,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":116,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":76,"visibilityKm":10,"pressureMb":1025},{"hour":23,"tempC":13,"weatherDesc":"Partly cloudy","cloudCoverPct":40,"uvIndex":1,"windspeedKph":5,"windDirectionDeg":108,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":77,"visibilityKm":10,"pressureMb":1025}]}

        expected = 0.11
        actual = self.CALCULATOR.cost_calculation_2(time, start_date, start_time, charger_configuration, location, api=requests_mock)
        self.assertAlmostEqual(expected, actual, 2)

    def test_solar_energy_produced(self):
        time = (1, 0)
        start_date = "25/12/2020"
        start_time = "8:00"
        charger_configuration = "3"
        location = "5bea7b46-9809-4189-aafe-160208da94f7"

        requests_mock = Mock()
        response_mock = Mock()
        requests_mock.get.return_value = response_mock
        response_mock.status_code = 200
        response_mock.json.return_value = {"date":"2020-12-25","sunrise":"05:10:00","sunset":"19:24:00","moonrise":"15:04:00","moonset":"01:48:00","moonPhase":"Waxing Gibbous","moonIlluminationPct":70,"minTempC":27,"maxTempC":36,"avgTempC":33,"sunHours":8.6,"uvIndex":8,"location":{"id":"5bea7b46-9809-4189-aafe-160208da94f7","postcode":"6001","name":"PERTH","state":"WA","latitude":"-31.9505269","longitude":"115.8604572","distanceToNearestWeatherStationMetres":3672.959393589811,"nearestWeatherStation":{"name":"PERTH METRO","state":"WA","latitude":"-31.9192","longitude":"115.8728"}},"hourlyWeatherHistory":[{"hour":0,"tempC":29,"weatherDesc":"Partly cloudy","cloudCoverPct":1,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":122,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":1,"tempC":29,"weatherDesc":"Partly cloudy","cloudCoverPct":1,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":122,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":2,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":2,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":123,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":3,"tempC":27,"weatherDesc":"Partly cloudy","cloudCoverPct":2,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":123,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":4,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":3,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":152,"windDirectionCompass":"SSE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":5,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":4,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":182,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":22,"visibilityKm":10,"pressureMb":1009},{"hour":6,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":5,"uvIndex":7,"windspeedKph":3,"windDirectionDeg":211,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":22,"visibilityKm":10,"pressureMb":1009},{"hour":7,"tempC":30,"weatherDesc":"Partly cloudy","cloudCoverPct":8,"uvIndex":7,"windspeedKph":4,"windDirectionDeg":248,"windDirectionCompass":"WSW","precipitationMm":0,"humidityPct":21,"visibilityKm":10,"pressureMb":1009},{"hour":8,"tempC":31,"weatherDesc":"Partly cloudy","cloudCoverPct":11,"uvIndex":8,"windspeedKph":5,"windDirectionDeg":286,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":19,"visibilityKm":10,"pressureMb":1009},{"hour":9,"tempC":32,"weatherDesc":"Partly cloudy","cloudCoverPct":13,"uvIndex":8,"windspeedKph":5,"windDirectionDeg":324,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":18,"visibilityKm":10,"pressureMb":1009},{"hour":10,"tempC":33,"weatherDesc":"Partly cloudy","cloudCoverPct":13,"uvIndex":8,"windspeedKph":8,"windDirectionDeg":300,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":17,"visibilityKm":10,"pressureMb":1009},{"hour":11,"tempC":35,"weatherDesc":"Partly cloudy","cloudCoverPct":14,"uvIndex":8,"windspeedKph":11,"windDirectionDeg":276,"windDirectionCompass":"W","precipitationMm":0,"humidityPct":16,"visibilityKm":10,"pressureMb":1008},{"hour":12,"tempC":36,"weatherDesc":"Partly cloudy","cloudCoverPct":14,"uvIndex":9,"windspeedKph":14,"windDirectionDeg":252,"windDirectionCompass":"WSW","precipitationMm":0,"humidityPct":16,"visibilityKm":10,"pressureMb":1008},{"hour":13,"tempC":36,"weatherDesc":"Partly cloudy","cloudCoverPct":21,"uvIndex":9,"windspeedKph":17,"windDirectionDeg":242,"windDirectionCompass":"WSW","precipitationMm":0,"humidityPct":17,"visibilityKm":10,"pressureMb":1007},{"hour":14,"tempC":35,"weatherDesc":"Cloudy","cloudCoverPct":28,"uvIndex":8,"windspeedKph":19,"windDirectionDeg":232,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":19,"visibilityKm":10,"pressureMb":1007},{"hour":15,"tempC":35,"weatherDesc":"Cloudy","cloudCoverPct":35,"uvIndex":8,"windspeedKph":22,"windDirectionDeg":223,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":21,"visibilityKm":10,"pressureMb":1006},{"hour":16,"tempC":34,"weatherDesc":"Cloudy","cloudCoverPct":42,"uvIndex":7,"windspeedKph":21,"windDirectionDeg":217,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":24,"visibilityKm":10,"pressureMb":1006},{"hour":17,"tempC":33,"weatherDesc":"Partly cloudy","cloudCoverPct":48,"uvIndex":8,"windspeedKph":20,"windDirectionDeg":212,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":27,"visibilityKm":10,"pressureMb":1006},{"hour":18,"tempC":32,"weatherDesc":"Partly cloudy","cloudCoverPct":54,"uvIndex":1,"windspeedKph":19,"windDirectionDeg":207,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":30,"visibilityKm":10,"pressureMb":1006},{"hour":19,"tempC":31,"weatherDesc":"Partly cloudy","cloudCoverPct":42,"uvIndex":1,"windspeedKph":18,"windDirectionDeg":196,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":34,"visibilityKm":10,"pressureMb":1007},{"hour":20,"tempC":30,"weatherDesc":"Partly cloudy","cloudCoverPct":30,"uvIndex":1,"windspeedKph":17,"windDirectionDeg":186,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":37,"visibilityKm":10,"pressureMb":1007},{"hour":21,"tempC":29,"weatherDesc":"Partly cloudy","cloudCoverPct":18,"uvIndex":1,"windspeedKph":16,"windDirectionDeg":175,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":40,"visibilityKm":10,"pressureMb":1008},{"hour":22,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":28,"uvIndex":1,"windspeedKph":16,"windDirectionDeg":159,"windDirectionCompass":"SSE","precipitationMm":0,"humidityPct":42,"visibilityKm":10,"pressureMb":1008},{"hour":23,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":39,"uvIndex":1,"windspeedKph":16,"windDirectionDeg":142,"windDirectionCompass":"SE","precipitationMm":0,"humidityPct":44,"visibilityKm":10,"pressureMb":1008}]}

        expected = 0.13
        actual = self.CALCULATOR.cost_calculation_2(time, start_date, start_time, charger_configuration, location, api=requests_mock)
        self.assertAlmostEqual(expected, actual, 2)

    def test_solar_energy_exceeds_power(self):
        time = (1, 0)
        start_date = "25/12/2020"
        start_time = "8:00"
        charger_configuration = "1"
        location = "5bea7b46-9809-4189-aafe-160208da94f7"

        requests_mock = Mock()
        response_mock = Mock()
        requests_mock.get.return_value = response_mock
        response_mock.status_code = 200
        response_mock.json.return_value = {"date":"2020-12-25","sunrise":"05:10:00","sunset":"19:24:00","moonrise":"15:04:00","moonset":"01:48:00","moonPhase":"Waxing Gibbous","moonIlluminationPct":70,"minTempC":27,"maxTempC":36,"avgTempC":33,"sunHours":8.6,"uvIndex":8,"location":{"id":"5bea7b46-9809-4189-aafe-160208da94f7","postcode":"6001","name":"PERTH","state":"WA","latitude":"-31.9505269","longitude":"115.8604572","distanceToNearestWeatherStationMetres":3672.959393589811,"nearestWeatherStation":{"name":"PERTH METRO","state":"WA","latitude":"-31.9192","longitude":"115.8728"}},"hourlyWeatherHistory":[{"hour":0,"tempC":29,"weatherDesc":"Partly cloudy","cloudCoverPct":1,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":122,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":1,"tempC":29,"weatherDesc":"Partly cloudy","cloudCoverPct":1,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":122,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":2,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":2,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":123,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":3,"tempC":27,"weatherDesc":"Partly cloudy","cloudCoverPct":2,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":123,"windDirectionCompass":"ESE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":4,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":3,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":152,"windDirectionCompass":"SSE","precipitationMm":0,"humidityPct":23,"visibilityKm":10,"pressureMb":1009},{"hour":5,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":4,"uvIndex":1,"windspeedKph":4,"windDirectionDeg":182,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":22,"visibilityKm":10,"pressureMb":1009},{"hour":6,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":5,"uvIndex":7,"windspeedKph":3,"windDirectionDeg":211,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":22,"visibilityKm":10,"pressureMb":1009},{"hour":7,"tempC":30,"weatherDesc":"Partly cloudy","cloudCoverPct":8,"uvIndex":7,"windspeedKph":4,"windDirectionDeg":248,"windDirectionCompass":"WSW","precipitationMm":0,"humidityPct":21,"visibilityKm":10,"pressureMb":1009},{"hour":8,"tempC":31,"weatherDesc":"Partly cloudy","cloudCoverPct":11,"uvIndex":8,"windspeedKph":5,"windDirectionDeg":286,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":19,"visibilityKm":10,"pressureMb":1009},{"hour":9,"tempC":32,"weatherDesc":"Partly cloudy","cloudCoverPct":13,"uvIndex":8,"windspeedKph":5,"windDirectionDeg":324,"windDirectionCompass":"NW","precipitationMm":0,"humidityPct":18,"visibilityKm":10,"pressureMb":1009},{"hour":10,"tempC":33,"weatherDesc":"Partly cloudy","cloudCoverPct":13,"uvIndex":8,"windspeedKph":8,"windDirectionDeg":300,"windDirectionCompass":"WNW","precipitationMm":0,"humidityPct":17,"visibilityKm":10,"pressureMb":1009},{"hour":11,"tempC":35,"weatherDesc":"Partly cloudy","cloudCoverPct":14,"uvIndex":8,"windspeedKph":11,"windDirectionDeg":276,"windDirectionCompass":"W","precipitationMm":0,"humidityPct":16,"visibilityKm":10,"pressureMb":1008},{"hour":12,"tempC":36,"weatherDesc":"Partly cloudy","cloudCoverPct":14,"uvIndex":9,"windspeedKph":14,"windDirectionDeg":252,"windDirectionCompass":"WSW","precipitationMm":0,"humidityPct":16,"visibilityKm":10,"pressureMb":1008},{"hour":13,"tempC":36,"weatherDesc":"Partly cloudy","cloudCoverPct":21,"uvIndex":9,"windspeedKph":17,"windDirectionDeg":242,"windDirectionCompass":"WSW","precipitationMm":0,"humidityPct":17,"visibilityKm":10,"pressureMb":1007},{"hour":14,"tempC":35,"weatherDesc":"Cloudy","cloudCoverPct":28,"uvIndex":8,"windspeedKph":19,"windDirectionDeg":232,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":19,"visibilityKm":10,"pressureMb":1007},{"hour":15,"tempC":35,"weatherDesc":"Cloudy","cloudCoverPct":35,"uvIndex":8,"windspeedKph":22,"windDirectionDeg":223,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":21,"visibilityKm":10,"pressureMb":1006},{"hour":16,"tempC":34,"weatherDesc":"Cloudy","cloudCoverPct":42,"uvIndex":7,"windspeedKph":21,"windDirectionDeg":217,"windDirectionCompass":"SW","precipitationMm":0,"humidityPct":24,"visibilityKm":10,"pressureMb":1006},{"hour":17,"tempC":33,"weatherDesc":"Partly cloudy","cloudCoverPct":48,"uvIndex":8,"windspeedKph":20,"windDirectionDeg":212,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":27,"visibilityKm":10,"pressureMb":1006},{"hour":18,"tempC":32,"weatherDesc":"Partly cloudy","cloudCoverPct":54,"uvIndex":1,"windspeedKph":19,"windDirectionDeg":207,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":30,"visibilityKm":10,"pressureMb":1006},{"hour":19,"tempC":31,"weatherDesc":"Partly cloudy","cloudCoverPct":42,"uvIndex":1,"windspeedKph":18,"windDirectionDeg":196,"windDirectionCompass":"SSW","precipitationMm":0,"humidityPct":34,"visibilityKm":10,"pressureMb":1007},{"hour":20,"tempC":30,"weatherDesc":"Partly cloudy","cloudCoverPct":30,"uvIndex":1,"windspeedKph":17,"windDirectionDeg":186,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":37,"visibilityKm":10,"pressureMb":1007},{"hour":21,"tempC":29,"weatherDesc":"Partly cloudy","cloudCoverPct":18,"uvIndex":1,"windspeedKph":16,"windDirectionDeg":175,"windDirectionCompass":"S","precipitationMm":0,"humidityPct":40,"visibilityKm":10,"pressureMb":1008},{"hour":22,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":28,"uvIndex":1,"windspeedKph":16,"windDirectionDeg":159,"windDirectionCompass":"SSE","precipitationMm":0,"humidityPct":42,"visibilityKm":10,"pressureMb":1008},{"hour":23,"tempC":28,"weatherDesc":"Partly cloudy","cloudCoverPct":39,"uvIndex":1,"windspeedKph":16,"windDirectionDeg":142,"windDirectionCompass":"SE","precipitationMm":0,"humidityPct":44,"visibilityKm":10,"pressureMb":1008}]}

        expected = 0
        actual = self.CALCULATOR.cost_calculation_2(time, start_date, start_time, charger_configuration, location, api=requests_mock)
        self.assertAlmostEqual(expected, actual, 2)


if __name__ == '__main__':
    unittest.main()
